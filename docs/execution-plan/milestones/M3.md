# M3 - SPEC/API Drift Resolution

## Objective

Reconcile runtime behavior, public API names, and specs (SPEC-20/26/27) so implementation and documentation are consistent and consumable.

## Entry Criteria

- M2 complete.
- D-004 and D-005 approved.

## Exit Criteria

- Batched query naming strategy is implemented and documented.
- SPEC file paths and protocol details are accurate.
- Spec-to-test traceability exists for M1-M3 scope.

## Task Cards

### M3-T01 Resolve Batched Query API Naming and Compatibility

- Goal: remove naming ambiguity between spec and runtime.
- Work items:
- Implement agreed canonical function and compatibility alias.
- Add deprecation behavior if required by policy.
- Update helper exports and sandbox function list.
- Acceptance criteria:
- Existing consumer calls keep working during migration window.
- Canonical name is documented unambiguously.
- Required gates: VG-DOC-SPEC-001, VG-CONTRACT-001

### M3-T02 Fix SPEC-20 File Locations and Protocol References

- Goal: eliminate stale/incorrect spec references (for example `python/rlm_repl/submit.py`).
- Work items:
- Update file-location table and protocol examples in SPEC-20.
- Cross-check references against actual repository layout.
- Acceptance criteria:
- No invalid file paths remain in targeted sections.
- Required gates: VG-DOC-SPEC-001

### M3-T03 Reconcile SPEC-26 and SPEC-27 with Runtime Architecture

- Goal: clearly separate implemented behavior from planned extensions.
- Work items:
- Mark implemented vs planned status in relevant sections.
- Ensure acceptance criteria reflect executable behavior.
- Acceptance criteria:
- Specs are actionable for implementation and review.
- Required gates: VG-DOC-SPEC-001

### M3-T04 Create Spec-to-Test Traceability Artifact

- Goal: map each key acceptance criterion to one or more tests/gates.
- Work items:
- Produce traceability table and store under evidence/docs.
- Include gap column for missing test coverage.
- Acceptance criteria:
- All M1-M3 critical acceptance criteria are mapped or explicitly marked as gaps.
- Required gates: VG-DOC-SPEC-001

## Risks

- Over-correcting docs without preserving compatibility can create hidden consumer breakage.
- Incomplete traceability allows regressions to escape review.

## Handoff Notes

M3 is complete. Next execution start point is `M4-T01`.
