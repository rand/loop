# M4 - Consumer Integration Tracks

## Objective

Execute and validate integration work against active consumers: `rlm-claude-code`, `loop-agent`, and `io-rflx`.

## Entry Criteria

- M3 complete.
- Consumer contract document reviewed (`contracts/CONSUMER-INTEGRATION.md`).

## Exit Criteria

- Hard consumer (`rlm-claude-code`) compatibility validated after loop changes.
- First concrete runtime integration seam for `loop-agent` is defined and testable.
- Concrete interoperability contract for `io-rflx` is defined and validated at baseline compile + contract level.

## Track A - `rlm-claude-code`

### M4-T01 Vendored Sync and Compatibility Validation

- Goal: align vendored loop usage with current loop changes safely.
- Work items:
- Define submodule/update strategy and version pin policy.
- Validate critical runtime paths (memory, classifier, router, trajectory).
- Capture migration notes if any symbol/behavior changes occur.
- Acceptance criteria:
- VG-RCC-001 passes.
- Contract invariants A1-A5 hold or have approved migration plan.
- Evidence records tested `vendor/loop` submodule SHA and loop candidate SHA scope.
- Required gates: VG-RCC-001, VG-CONTRACT-001

## Track B - `loop-agent`

### M4-T02 Define First Runtime Integration Seam

- Goal: move from conceptual dependency to concrete optional runtime integration.
- Work items:
- Define seam interfaces and fallback behavior.
- Select initial capabilities (recommended: classifier + trajectory).
- Define minimal integration tests in loop-agent.
- Publish seam contract under `contracts/LOOP-AGENT-RUNTIME-SEAM.md`.
- Acceptance criteria:
- Contract invariants B1-B3 are met by design and tests.
- Scope and boundaries are documented clearly.
- Full `loop-agent` suite status is captured as advisory evidence with explicit triage.
- Required gates: VG-LA-001, VG-CONTRACT-001

## Track C - `io-rflx`

### M4-T03 Define Interoperability Contract

- Goal: define practical contract-level integration without forcing hard dependency.
- Work items:
- Specify trajectory/provenance schema interchange points.
- Specify epistemic verification interface assumptions.
- Define benchmark interoperability touchpoints for M5.
- Publish interop contract under `contracts/IO-RFLX-INTEROP-CONTRACT.md`.
- Acceptance criteria:
- Contract invariants C1-C2 are documented and validated.
- Required gates: VG-RFLX-001, VG-CONTRACT-001

## Cross-Track

### M4-T04 Compatibility Pipeline

- Goal: make cross-repo compatibility checks repeatable.
- Work items:
- Document reproducible command set for all three consumers.
- Optionally codify as CI workflow or script orchestration.
- Baseline script target: `scripts/run_m4_compat_pipeline.sh`.
- Acceptance criteria:
- Pipeline can be run end-to-end with deterministic outputs.
- Required gates: VG-RCC-001, VG-LA-001, VG-RFLX-001

## Risks

- Hidden assumptions in vendored `rlm-core` usage may break `rlm-claude-code` behavior.
- `loop-agent` integration scope creep can delay milestone completion.
- `io-rflx` integration can drift into speculative architecture without clear contracts.

## Handoff Notes

At M4 completion, proceed to `M5-T01`.
